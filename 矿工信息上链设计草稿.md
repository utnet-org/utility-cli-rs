# 矿工信息上链和查询

## 必要条件

```shell
熟悉 opensssl 工具 或python脚本， 构造4096bits  rsa keypairs
熟悉 near-cli-rs  命令行工具， 底层逻辑都是rpc
构造 transaction payload

near-crypto = "0.19.0"
```

## 算力机信息

```shell
RSA (sk', pk)
sk' = aes(ikv, rsa sk), ikv 128bits
pk 即 创建账号输入的公钥
extra miner number 矿工编号， miner power 矿工算力

openssl 工具/python 脚本 创建 4096 长度的 rsa keypairs
或者 创建隐式账号 access_keys 指定 rsa pubkey 生成密钥对
- 目前支持创建隐式 有 ed25519 原生， 有secp25619k1 的 btc/eth 的模式
- 验证签名也是verify 也是支持的
- 扩展支持rsa keypairs

导入 rsa keypairs 账户信息

矿工地址即rsa pk即account_id 隐式账户/access keys，可以给这个地址转账， rsa sk 去签名交易， 添加一对访问密钥为rsa keypairs

### <TODO: > 添加一对 rsa 的keypairs，之后都是用这个key 去签名， 验证那边则是rsa 的pk 去验证
### 参看 eth implicat 账户创建， 之后可以给他转账
### 支持直接创建支持rsa的隐式账户，或者添加rsa的访问密钥， 核心目的就是掌握rsa的密钥对的人控制这个账户， 转账，签名交易等等等。

### Plan B  矿工地址就是rsa的pk，支持转账 这些action， 然后还是用的ed25519私钥体系那一套，  这个地址 base64 弄成 64位的钱包地址，然后near 给他转账
## -- 直接给转账的逻辑的， 钱包地址
##  创建RSA keypairs

near account \
    create-account \
    fund-later \
    use-auto-generation \
    save-to-folder /Users/es/.near-credentials/implicit
```shell
es@192 implicit % cat 44040274051cf293f811e97e9899d7f54e152eac3845fd6743530649100e48d9.json 
{"implicit_account_id":"44040274051cf293f811e97e9899d7f54e152eac3845fd6743530649100e48d9","master_seed_phrase":"antenna satisfy involve labor olympic exhibit script off island sea head spawn","private_key":"ed25519:4jwBs8HeaBJkC2oDFq2uA5uzQSXh1Lpz6BNSAyi7pSgXA24oiUYu6oSZuxmJ9sZWz1vSQ2FhcHuhMpTCFmN3ZrY","public_key":"ed25519:5aWGdk6sirxRxHWfeherW4u3ttB6uWKg9gm1fr8NpeV6","seed_phrase_hd_path":"m/44'/397'/0'"}%  
```
    

near account \
    add-key fro_volod.testnet \
    grant-full-access \
    use-manually-provided-public-key ed25519:75a5ZgVZ9DFTxs4THtFxPtLj7AY3YzpxtapTQBdcMXx3 \
    network-config testnet \
    sign-with-keychain \
    send

construct-transaction - Construct a new transaction 构建交易
Let's consider an example when it is necessary to perform several actions within one transaction:
让我们考虑一个需要在一个事务内执行多个操作的例子：
Create an account 创建一个账户
Add access keys to the created account 为创建的账户添加访问密钥
Transfer tokens to the created account 将代币转移到创建的账户

```

## near钱包地址

```shell
隐式账户 implicit account  一组ed25519密钥对, accountID由32字节长度的公钥base58解码后转hex
fund-later - 创建一个隐式账户

near account \
    create-account \
    fund-later \
    use-auto-generation \
    save-to-folder /Users/frovolod/.near-credentials/implicit

near account \
    create-account \
    fund-later \
    use-seed-phrase 'start vote foot cereal link cabin fantasy universe hero drama bird fiction' \
        --seed-phrase-hd-path 'm/44'\''/397'\''/0'\''' \
    save-to-folder /Users/frovolod/.near-credentials/implicit

### 更新near 账户合约的社交信息
near account \
    update-social-profile fro_volod.testnet \
    json-args '{"name":"frovolod","image":{"ipfs_cid":"bafkreifdzusz6hp3j4njdtqqxr3tlvx4agedgh7znyac4wbuiao3gtppde"},"linktree":{"github":"FroVolod","telegram":"frovolod"},"tags": {"rust":"","near":"","developer":""}}' \
    sign-as fro_volod.testnet \
    network-config testnet \
    sign-with-keychain \
    send

```

## transaction 交易信息

```shell
sign_tx 签署交易
send_tx,  tx payload:
- rsa (sk', pk')
- miner power
- miner address
- miner number
```

## verify 链上校验 钱包地址或者RSA 私钥

```shell
钱包地址校验签名 ed25519
check_transaction_tx  检查交易的tx， 这个应该是发送给wasm runtime 的时候
```

## 命令行展示， 查看矿工信息（矿工信息修改）

```shell
near-cli-rs  miner info  rpc 接口实现
miner power
miner number
miner address
...

```

## Q & A

Q: rsa 的公钥发出来的制作的矿工地址， 校验签名也得对称的rsa 校验， 目前的ed25519 创建的账户/添加full_access访问密钥 怎么去check transaction_tx ?
添加创建隐式账户， 目前的secp256k1 用于以太坊的隐式账户， web3钱包合约， all-in-one 的介入以太坊转账
添加的access keys 的keypairs 的话， 这个好像默认也是 ed25519 密钥对， 可以用rsa 创建一对 ？
near-crytpo 的signature/signer 添加支持rsa，verify的 validator 的识别 rsa的签名交易， 去verify rsa 的消息是否匹配

Q: check_transaction_tx 这个逻辑， 校验签名逻辑代码点在哪里？ 用的ed25519 去校验的签名？
send_tx  vaildator 节点 收到newly transaction 后 verfiy，假消息这块儿直接不负责转发？
check_tx  transaction_pool 不合法的签名的tx 应该没机会进入交易内存池， 加入pool前再检查?
发送构造交易都是ed25519 curve 曲线， 和 rsa 是不同的密钥体系
